{{ attach_library('emulsifymars/product-selector') }}

{% set product_selector_class = product_selector_class|default('product-selector') %}

<section {{bem(product_selector_class)}} data-theme={{theme_styles}}>
  {% for key, product in products %}
    <div {{bem('information', [], product_selector_class, ['product-' ~ product.id, key != 0 ? 'visually-hidden' : ''])}}>
      <div {{bem('image', [], product_selector_class)}}>
        {% for product_variant in product.variants %}
          {% set product_variant_images = {
            1440: product_variant.image_src|resize(277, 277),
            768: product_variant.image_src|resize(150, 150),
            375: product_variant.image_src|resize(133, 133),
          } %}
          {% include "@atoms/images/image/_image.twig" with {
            image_alt: product_variant.image_alt,
            image_src: product_variant.image_src|resize(277, 277),
            image_array: product_variant_images,
            image_extra_classes: ['visually-hidden', 'variant-image', 'gtin-' ~ product_variant.gtin]
          } %}
        {% endfor %}
      </div>
      <div {{bem('title', [], product_selector_class)}}>
        {{ product.title }}
      </div>
    </div>
  {% endfor %}
  <div {{bem('form-container', [], product_selector_class)}}>
    <form {{bem('form', [], product_selector_class)}}>
      <div {{bem('select-wrapper', [], product_selector_class)}}>
        <select {{bem('item-selector', [], product_selector_class)}}>
          {% for product in products %}
            <option data-id="{{ product.id }}" data-variants="{{ product.variants_json }}">{{ product.title }}</option>
          {% endfor %}
        </select>
      </div>
      <div {{bem('select-wrapper', [], product_selector_class)}}>
        <select {{bem('product-variant-selector', [], product_selector_class)}}>
          {% for variant in products[0].variants %}
            <option data-id="{{ variant.gtin }}" value="{{ variant.size }}">{{ variant.size }}</option>
          {% endfor %}
        </select>
      </div>
    </form>

    <script id="cci-widget"
            type="text/javascript"
            src="//fi-v2.global.commerce-connector.com/cc.js"
            data-token="{{ data_token }}"
            data-locale="{{ data_locale }}"
            data-displaylanguage="{{ data_displaylanguage }}"
            data-widgetid="{{ widget_id }}"
            data-ean="{{ default_product.variants[0].gtin }}"
            data-subid="{{ data_subid }}"
            defer
    ></script>

  </div>
</section>
