{#
/**
 * @file
 * Template for the product card component.
 */
#}

{% set main_media = main_variant | entityMainMediaId | mediaParamsById %}
{% set product_card_media = main_variant | productCardMedia | mediaParamsById %}
{% set grp_title = main_variant.field_product_variant_grp_title.value %}
{% set grp_media = main_variant | entityGroupMediaId | mediaParamsById %}
{% set has_grp_media = grp_media.error is not defined or not grp_media %}

{% set has_card_media = product_card_media.error is not defined or not product_card_media.error %}

{% if has_card_media %}
  {% set background_image =  product_card_media.src %}
  {% set hover_image =  main_media.src %}
{% else %}
  {% set background_image =  main_media.src %}
  {% set hover_image = null %}
{% endif %}

{% if grp_title and has_grp_media %}
  {% set background_image =  grp_media.src is empty ? background_image : grp_media.src %}
  {% set hover_image = null %}
{% endif %}

{% set default_link_content_text = 'SEE DETAILS' | mt %}
{% set default_link_attributes = {href: url, 'data-click-name': default_link_content_text} %}
{% include "@molecules/card/product-card/product-card.twig" with {
  theme_styles: 'drupal',
  card__eyebrow: elements['#eyebrow'],
  brand__shape: elements['#brand_shape'],
  paragraph_size: 'large',
  paragraph_base_class: 'paragraph',
  paragraph_modifiers: ['large'],
  default_link_content: default_link_content_text,
  default_link_base_class: 'default-link',
  link_content: 'BUY NOW' | mt,
  is_new: node.field_product_new.value,
  badge_text: badge_text,
  link_base_class: 'text_link',
  wtb_commerce_vendor: wtb_commerce_vendor,
  wtb_button_type: wtb_button_type,
  wtb_widget_id: wtb_widget_id,
  wtb_button_class: wtb_button_class,
  wtb_manual_link_info: wtb_manual_link_info,
  price_spider_link_info: price_spider_link_info,
  mik_mak_link_info: mik_mak_link_info,
  product_sku: product_sku,
  datalayer_taxonomy: datalayer_taxonomy,
  item: {
    card_url: url,
    card__image__src: background_image,
    card__image__hover__src: hover_image,
    paragraph_content: (grp_title is empty) ? node.title.value : grp_title,
    default_link_attributes: default_link_attributes,
    link_url: ''
  },
  show_rating_and_reviews: show_rating_and_reviews,
  select_background_color: select_background_color,
  select__background__color: elements['#select__background__color'],
  default_link_content: card_button_text,
  text_color_override: elements['#text_color_override']
} %}
